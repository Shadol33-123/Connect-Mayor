import{u as y,b as v,j as e,s as i}from"./index-DNQbeVAn.js";import{C as o}from"./Card-BcRLNdqC.js";import{S as d}from"./Skeleton-CGa9HBs8.js";import{g as w,R as N}from"./RankBadge-B6GHI0D6.js";import{P as k}from"./ProgressBar-DsJwVye4.js";function S(){var h,f;const{user:l}=y(),{data:s,isLoading:x,error:m}=v({queryKey:["ranking",l==null?void 0:l.id],queryFn:async()=>{const{data:t,error:a}=await i.from("users_profile").select("user_id, display_name, total_xp").order("total_xp",{ascending:!1}).limit(100);if(a)throw a;let r=null,j=null,g=0;if(l){const{count:_}=await i.from("users_profile").select("user_id",{head:!0,count:"exact"});g=_||0;const{data:c}=await i.from("users_profile").select("user_id, display_name, total_xp").eq("user_id",l.id).limit(1);if(r=(c==null?void 0:c[0])||null,r){const{count:b}=await i.from("users_profile").select("user_id",{head:!0,count:"exact"}).gt("total_xp",r.total_xp);j=(b||0)+1}}return{ranking:t||[],userRow:r,position:j,totalUsers:g}},staleTime:6e4}),p=((h=s==null?void 0:s.userRow)==null?void 0:h.total_xp)||0,n=w(p),u=s!=null&&s.position&&s.totalUsers>0?Math.round((s.totalUsers-s.position)/s.totalUsers*100):null;return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 space-y-8",children:[e.jsxs("header",{className:"text-center space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Ranking Global"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Sube de rango completando lecciones y acumulando XP."})]}),l?e.jsxs(o,{className:"p-4 rounded-2xl flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-4",children:[x?e.jsx(d,{className:"w-12 h-12 rounded-xl"}):e.jsx(N,{xp:p}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-slate-800",children:((f=s==null?void 0:s.userRow)==null?void 0:f.display_name)||"Yo"}),(s==null?void 0:s.position)&&e.jsxs("span",{className:"text-xs text-slate-500",children:["PosiciÃ³n #",s.position," de ",s.totalUsers,u!==null&&` â€¢ Top ${u}%`]}),n.next&&e.jsxs("span",{className:"text-[11px] text-slate-500 mt-1",children:["Faltan ",n.remaining," XP para ",n.next.label]})]})]}),n.next&&e.jsxs("div",{className:"md:w-64",children:[e.jsx(k,{value:n.pct,className:"mb-1"}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:["Progreso hacia ",n.next.label]})]})]}):e.jsx(o,{className:"p-4 rounded-2xl text-center text-sm text-slate-600",children:"Inicia sesiÃ³n para ver tu posiciÃ³n."}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Podio"}),e.jsx("div",{className:"grid sm:grid-cols-3 gap-4",children:[0,1,2].map(t=>{const a=s==null?void 0:s.ranking[t];return e.jsxs(o,{className:"rounded-2xl p-4 flex flex-col items-center gap-2 relative",children:[e.jsxs("span",{className:"absolute top-2 right-3 text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-1 rounded",children:["#",t+1]}),a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-2xl","aria-hidden":!0,children:t===0?"ðŸ‘‘":t===1?"ðŸ¥ˆ":"ðŸ¥‰"}),e.jsx("span",{className:"font-semibold text-center truncate w-full",children:a.display_name||"Usuario "+a.user_id.slice(0,6)}),e.jsxs("span",{className:"text-[11px] text-slate-500",children:[a.total_xp," XP"]})]}):e.jsx(d,{className:"h-10 w-full"})]},t)})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Top 100"}),e.jsxs("div",{className:"space-y-2",children:[x&&Array.from({length:8}).map((t,a)=>e.jsx(d,{className:"h-14 w-full rounded-xl"},a)),m&&e.jsx("div",{className:"text-red-600 text-sm",children:m.message}),s==null?void 0:s.ranking.map((t,a)=>{const r=t.user_id===(l==null?void 0:l.id);return e.jsxs(o,{className:`rounded-xl p-3 flex items-center justify-between ${r?"ring-2 ring-blue-400 shadow-md":""}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`text-base font-bold w-8 text-center ${a<3?"text-indigo-600":"text-slate-600"}`,children:a+1}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-sm truncate max-w-[160px]",children:t.display_name||"Usuario "+t.user_id.slice(0,6)}),e.jsxs("span",{className:"text-[11px] text-slate-500",children:[t.total_xp," XP"]})]})]}),e.jsx(N,{xp:t.total_xp})]},t.user_id)}),s&&s.ranking.length===0&&!x&&e.jsx("div",{className:"text-center text-slate-500 text-sm",children:"Sin datos de ranking todavÃ­a."})]})]})]})}export{S as default};
