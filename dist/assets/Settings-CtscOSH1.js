import{u as ee,g as se,l as re,r,v as X,a as te,j as e,B as c,f as ae,s as p}from"./index-DNQbeVAn.js";import{C as d}from"./Card-BcRLNdqC.js";function ie(){const{user:a,signOut:Z}=ee(),m=se(),x=re(),[j,y]=r.useState(""),[l,N]=r.useState(""),[v,w]=r.useState(""),[k,C]=r.useState(""),[f,S]=r.useState(""),[t,_]=r.useState(""),[E,P]=r.useState(""),[L,R]=r.useState(""),[U,I]=r.useState(""),[T,M]=r.useState(""),[A,V]=r.useState(""),[G,z]=r.useState(!0),[D,O]=r.useState(!0),[B,$]=r.useState(!1),[q,F]=r.useState(!0),[H,u]=r.useState(null),[Q,o]=r.useState(null),[n,i]=r.useState(!1);r.useEffect(()=>{const s=m.data;s&&(y(s.display_name||""),N(s.username||""),w(s.first_name||""),C(s.last_name||""),S(s.age??""),_(s.rut||""),P(s.bio||""),R(s.website||""),I(s.linkedin||""),M(s.github||""),V(s.portfolio||""),z(s.show_achievements??!0),O(s.show_progress??!0),$(s.show_personal??!1),F(s.show_links??!0))},[m.data]);const h=r.useMemo(()=>/^[a-z0-9_]{3,20}$/i.test(l||""),[l]),b=r.useMemo(()=>!t||X(t),[t]),g=r.useMemo(()=>!t||te(t),[t]);async function J(){if(a){i(!0),u(null),o(null);try{if(t&&!X(t))throw new Error("RUT inv√°lido (8-9 d√≠gitos + DV correcto)");if(l){if(!h)throw new Error("Nombre de usuario inv√°lido (solo letras, n√∫meros y _; m√≠nimo 3).");const{data:W}=await p.from("users_profile").select("user_id").ilike("username",l).neq("user_id",a.id).limit(1);if(W&&W.length>0)throw new Error("El nombre de usuario ya est√° en uso.")}const{error:s}=await p.from("users_profile").upsert({user_id:a.id,display_name:j,username:l,first_name:v,last_name:k,age:typeof f=="number"?f:null,rut:t,bio:E,website:L||null,linkedin:U||null,github:T||null,portfolio:A||null,show_links:q,show_achievements:G,show_progress:D,show_personal:B});if(s)throw s;u("‚úÖ Perfil actualizado correctamente"),m.refetch()}catch(s){o("‚ùå Error: "+s.message)}finally{i(!1)}}}async function K(){i(!0),u(null),o(null);try{const{error:s}=await p.auth.resetPasswordForEmail((a==null?void 0:a.email)||"",{redirectTo:window.location.origin+"/login"});if(s)throw s;u("üìß Se envi√≥ un email para restablecer tu contrase√±a")}catch(s){o("‚ùå Error: "+s.message)}finally{i(!1)}}async function Y(){i(!0);try{await Z(),x("/login")}catch(s){o("‚ùå Error al cerrar sesi√≥n: "+s.message)}finally{i(!1)}}return a?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"ghost",onClick:()=>x(-1),className:"text-gray-600 hover:text-gray-900",children:"‚Üê Volver"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Configuraci√≥n"})]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-8",children:[H&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800",children:H}),Q&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800",children:Q}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(d,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Informaci√≥n de la cuenta"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Usuario p√∫blico (√∫nico)"}),e.jsx("input",{type:"text",value:l,onChange:s=>N(s.target.value.toLowerCase()),placeholder:"tu_usuario",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${l&&!h?"border-red-400":""}`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Se usar√° en tu perfil p√∫blico: /u/",l||"usuario"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:a.email||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"El email no se puede cambiar"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre para mostrar"}),e.jsx("input",{type:"text",value:j,onChange:s=>y(s.target.value),placeholder:"Ingresa tu nombre",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre"}),e.jsx("input",{type:"text",value:v,onChange:s=>w(s.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Apellido"}),e.jsx("input",{type:"text",value:k,onChange:s=>C(s.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Edad"}),e.jsx("input",{type:"number",min:0,value:f,onChange:s=>S(s.target.value===""?"":Number(s.target.value)),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"RUT"}),e.jsx("input",{type:"text",value:t,onChange:s=>_(ae(s.target.value)),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${t&&(!g||!b)?"border-red-400":""}`}),t&&(!g||!b)&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:"RUT inv√°lido (8-9 d√≠gitos + DV)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sobre m√≠"}),e.jsx("textarea",{value:E,onChange:s=>P(s.target.value),rows:3,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sitio web"}),e.jsx("input",{type:"url",value:L,onChange:s=>R(s.target.value),placeholder:"https://tuweb.com",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"LinkedIn"}),e.jsx("input",{type:"url",value:U,onChange:s=>I(s.target.value),placeholder:"https://linkedin.com/in/usuario",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"GitHub"}),e.jsx("input",{type:"url",value:T,onChange:s=>M(s.target.value),placeholder:"https://github.com/usuario",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Portfolio"}),e.jsx("input",{type:"url",value:A,onChange:s=>V(s.target.value),placeholder:"https://portfolio.com",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsx(c,{onClick:J,disabled:!!(n||!h||t&&(!g||!b)),className:"w-full sm:w-auto",children:n?"Guardando...":"Guardar cambios"})]})]}),e.jsxs(d,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Seguridad"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Cambiar contrase√±a"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Te enviaremos un email con un enlace para restablecer tu contrase√±a."}),e.jsx(c,{variant:"ghost",onClick:K,disabled:n,children:n?"Enviando...":"Restablecer contrase√±a"})]})})]}),e.jsxs(d,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Preferencias"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Mostrar progreso p√∫blicamente"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Otros podr√°n ver tu XP y avances."})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:D,onChange:s=>O(s.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-blue-600 after:content-[''] after:absolute after:h-5 after:w-5 after:bg-white after:rounded-full after:top-[2px] after:left-[2px] after:transition-all peer-checked:after:translate-x-full"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Mostrar logros p√∫blicamente"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Controla si tus insignias son visibles."})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:G,onChange:s=>z(s.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-blue-600 after:content-[''] after:absolute after:h-5 after:w-5 after:bg-white after:rounded-full after:top-[2px] after:left-[2px] after:transition-all peer-checked:after:translate-x-full"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Mostrar datos personales"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Edad y RUT en el perfil p√∫blico."})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:B,onChange:s=>$(s.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-blue-600 after:content-[''] after:absolute after:h-5 after:w-5 after:bg-white after:rounded-full after:top-[2px] after:left-[2px] after:transition-all peer-checked:after:translate-x-full"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Mostrar enlaces profesionales"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Sitio, LinkedIn, GitHub, Portfolio en tu perfil p√∫blico."})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:q,onChange:s=>F(s.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-blue-600 after:content-[''] after:absolute after:h-5 after:w-5 after:bg-white after:rounded-full after:top-[2px] after:left-[2px] after:transition-all peer-checked:after:translate-x-full"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Notificaciones por email"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Recibe actualizaciones sobre tu progreso"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Sonidos de la aplicaci√≥n"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Reproducir sonidos al completar lecciones"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]}),e.jsxs(d,{className:"p-6 border-red-200",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-red-600",children:"Zona de peligro"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Cerrar sesi√≥n"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Cierra tu sesi√≥n actual en este dispositivo."}),e.jsx(c,{variant:"secondary",onClick:Y,disabled:n,children:n?"Cerrando sesi√≥n...":"Cerrar sesi√≥n"})]})})]})]})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs(d,{className:"p-8 text-center",children:[e.jsx("h1",{className:"text-xl font-semibold mb-4",children:"Acceso requerido"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Debes iniciar sesi√≥n para acceder a la configuraci√≥n."}),e.jsx(c,{onClick:()=>x("/login"),children:"Iniciar sesi√≥n"})]})})}export{ie as default};
